{
 "supplementary_code": "```c\nstruct squashfs_base_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n};\n```\n```c\n#define SQFS_MAGIC_NUMBER 0x73717368\n/* The three first members of squashfs_dir_index make a total of 12 bytes */\n#define SQFS_DIR_INDEX_BASE_LENGTH 12\n/* size of metadata (inode and directory) blocks */\n#define SQFS_METADATA_BLOCK_SIZE 8192\n/* Max. number of fragment entries in a metadata block is 512 */\n#define SQFS_MAX_ENTRIES 512\n/* Metadata blocks start by a 2-byte length header */\n#define SQFS_HEADER_SIZE 2\n#define SQFS_DIR_HEADER_SIZE 12\n#define SQFS_MISC_ENTRY_TYPE -1\n#define SQFS_EMPTY_FILE_SIZE 3\n#define SQFS_STOP_READDIR 1\n#define SQFS_EMPTY_DIR -1\n/*\n* A directory entry object has a fixed length of 8 bytes, corresponding to its\n* first four members, plus the size of the entry name, which is equal to\n* 'entry_name' + 1 bytes.\n*/\n#define SQFS_ENTRY_BASE_LENGTH 8\n/* Inode types */\n#define SQFS_DIR_TYPE 1\n#define SQFS_REG_TYPE 2\n#define SQFS_SYMLINK_TYPE 3\n#define SQFS_BLKDEV_TYPE 4\n#define SQFS_CHRDEV_TYPE 5\n#define SQFS_FIFO_TYPE 6\n#define SQFS_SOCKET_TYPE 7\n#define SQFS_LDIR_TYPE 8\n#define SQFS_LREG_TYPE 9\n#define SQFS_LSYMLINK_TYPE 10\n#define SQFS_LBLKDEV_TYPE 11\n#define SQFS_LCHRDEV_TYPE 12\n#define SQFS_LFIFO_TYPE 13\n#define SQFS_LSOCKET_TYPE 14\n```\n```c\nstruct squashfs_dir_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 start_block;\n__le32 nlink;\n__le16 file_size;\n__le16 offset;\n__le32 parent_inode;\n};\n```\n```c\nstruct squashfs_reg_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 start_block;\n__le32 fragment;\n__le32 offset;\n__le32 file_size;\n__le16 block_list[0];\n};\n```\n```c\n#define SQFS_IS_FRAGMENTED(A) ((A) != 0xFFFFFFFF)\n```\n```c\nstruct squashfs_ldir_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 nlink;\n__le32 file_size;\n__le32 start_block;\n__le32 parent_inode;\n__le16 i_count;\n__le16 offset;\n__le32 xattr;\nstruct squashfs_dir_index index[0];\n};\n```\n```c\nstruct squashfs_directory_index {\nu32 index;\nu32 start;\nu32 size;\nchar name[0];\n};\n```\n```c\nstruct squashfs_lreg_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le64 start_block;\n__le64 file_size;\n__le64 sparse;\n__le32 nlink;\n__le32 fragment;\n__le32 offset;\n__le32 xattr;\n__le32 block_list[0];\n};\n```\n```c\nstruct squashfs_symlink_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 nlink;\n__le32 symlink_size;\nchar symlink[0];\n};\n```\n```c\nstruct squashfs_dev_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 nlink;\n__le32 rdev;\n};\n```\n```c\nstruct squashfs_ldev_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 nlink;\n__le32 rdev;\n__le32 xattr;\n};\n```\n```c\nstruct squashfs_ipc_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 nlink;\n};\n```\n```c\nstruct squashfs_lipc_inode {\n__le16 inode_type;\n__le16 mode;\n__le16 uid;\n__le16 guid;\n__le32 mtime;\n__le32 inode_number;\n__le32 nlink;\n__le32 xattr;\n};\n```",
 "function_prototype": "int sqfs_inode_size(struct squashfs_base_inode *inode, u32 blk_size)",
 "re_implemented_code": "\n```c\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n// Assuming necessary structures are defined as per supplementary code.\nint get_unaligned_le16(const void* ptr) {\nconst unsigned char* p = ptr;\nreturn (p[0] << 8) | p[1];\n}\nint sqfs_inode_size(struct squashfs_base_inode *inode, u32 blk_size) {\nswitch(get_unaligned_le16(&inode->inode_type)) {\ncase SQFS_DIR_TYPE:\nreturn sizeof(struct squashfs_dir_inode);\ncase SQFS_REG_TYPE: {\nstruct squashfs_reg_inode *r_inode = (struct squashfs_reg_inode *)inode;\nu32 fragment = get_unaligned_le32(&r_inode->fragment);\nu32 file_size = get_unaligned_le32(&r_inode->file_size);\nu32 block_list_size;\nif(SQFS_IS_FRAGMENTED(fragment)) {\nblock_list_size = (((file_size + blk_size - 1)/blk_size)*sizeof(u32));\n} else {\nblock_list_size = ((file_size + blk_size - 1)/blk_size)*sizeof(u32);\n}\nreturn sizeof(*r_inode) + block_list_size;\n}\ncase SQFS_LDIR_TYPE: {\nstruct squashfs_ldir_inode *ld_inode = (struct squashfs_ldir_inode *)inode;\nu16 i_count = get_unaligned_le16(&ld_inode->i_count);\nu32 idx_list_size = 0;\nu16 l = 0;\nstruct squashfs_dir_index *dir_idx_ptr = ld_inode->index;\nif(i_count == 0) {\nreturn sizeof(*ld_inode);\n}\ndir_idx_ptr = (struct squashfs_dir_index *)(ld_inode->index);\nwhile(l < i_count) {\nu32 entry_length = get_unaligned_le32(&dir_idx_ptr[l].size);\nidx_list_size += entry_length;\nl++;\n}\nreturn sizeof(*ld_inode) + idx_list_size;\n}\ncase SQFS_LREG_TYPE: {\nstruct squashfs_lreg_inode *lr_inode = (struct squashfs_lreg_inode *)inode;\nu32 fragment = get_unaligned_le32(&lr_inode->fragment);\nu64 file_size = get_unaligned_le64(&lr_inode->file_size);\nu32 block_list_size;\nif(fragment == 0xFFFFFFFF) {\nblock_list_size = ((file_size + blk_size - 1)/blk_size)*sizeof(u32);\n} else {\nblock_list_size = ((file_size + blk_size - 1)/blk_size)*sizeof(u32);\n}\nreturn sizeof(*lr_inode) + block_list_size;\n}\ncase SQFS_SYMLINK_TYPE:\ncase SQFS_LSYMLINK_TYPE: {\nstruct squashfs_symlink_inode *slnk_inode = (struct squashfs_symlink_inode *)inode;\nu32 slnk_size = get_unaligned_le32(&slnk_inode->symlink_size);\nreturn sizeof(*slnk_inode) + slnk_size;\n}\ncase SQFS_BLKDEV_TYPE:\ncase SQFS_CHRDEV_TYPE:\nreturn sizeof(struct squashfs_dev_inode);\ncase SQFS_LBLKDEV_TYPE:\ncase SQFS_LCHRDEV_TYPE:\nreturn sizeof(struct squashfs_ldev_inode);\ncase SQFS_FIFO_TYPE:\ncase SQFS_SOCKET_TYPE:\nreturn sizeof(struct squashfs_ipc_inode);\ncase SQFS_LFIFO_TYPE:\ncase SQFS_LSOCKET_TYPE:\nreturn sizeof(struct squashfs_lipc_inode);\ndefault:\nprintf(\"Error: Unknown inode type %d\\n\", get_unaligned_le16(&inode->inode_type));\nreturn -1;\n}\n}\n```\n",
 "is_vulnerable": true
}