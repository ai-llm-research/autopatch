

typedef unsigned int u32;
typedef unsigned long long u64;
typedef unsigned short u16;

unsigned int strlen(const char *str);

static inline u16 get_unaligned_le16(const void *p)
{
    return *(const u16 *)p;
}

struct squashfs_base_inode {
    u16 inode_type;
    // Additional dummy fields as needed
};

struct squashfs_dir_inode {
    // Dummy fields as needed
};

struct squashfs_reg_inode {
    u32 fragment;
    u32 file_size;
    u32 block_list[1];  // Dummy
    // Additional dummy fields as needed
};

struct squashfs_ldir_inode {
    u16 i_count;
    struct squashfs_dir_index *index;
    // Additional dummy fields as needed
};

struct squashfs_lreg_inode {
    u32 fragment;
    u64 file_size;
    u32 block_list[1];  // Dummy
    // Additional dummy fields as needed
};

struct squashfs_symlink_inode {
    u32 symlink_size;
    // Additional dummy fields as needed
};

struct squashfs_dev_inode {
    // Dummy fields as needed
};

struct squashfs_ldev_inode {
    // Dummy fields as needed
};

struct squashfs_ipc_inode {
    // Dummy fields as needed
};

struct squashfs_lipc_inode {
    // Dummy fields as needed
};

struct squashfs_dir_index {
    char name[256];  // Dummy
    // Additional dummy fields as needed
};

// Dummy defines for inode types
#define SQFS_DIR_TYPE                1
#define SQFS_REG_TYPE                2
#define SQFS_LDIR_TYPE               3
#define SQFS_LREG_TYPE               4
#define SQFS_SYMLINK_TYPE            5
#define SQFS_LSYMLINK_TYPE           6
#define SQFS_BLKDEV_TYPE             7
#define SQFS_CHRDEV_TYPE             8
#define SQFS_LBLKDEV_TYPE            9
#define SQFS_LCHRDEV_TYPE            10
#define SQFS_FIFO_TYPE               11
#define SQFS_SOCKET_TYPE             12
#define SQFS_LFIFO_TYPE              13
#define SQFS_LSOCKET_TYPE            14

// Dummy macro
#define SQFS_IS_FRAGMENTED(x) ((x) != 0xFFFFFFFF)

// Placeholder define for directory index base length
#define SQFS_DIR_INDEX_BASE_LENGTH  4

int sqfs_inode_size(struct squashfs_base_inode *inode, u32 blk_size)
{
    switch (get_unaligned_le16(&inode->inode_type)) {

    case SQFS_DIR_TYPE:
        return sizeof(struct squashfs_dir_inode);

    case SQFS_REG_TYPE: {
        struct squashfs_reg_inode *reg = (struct squashfs_reg_inode *)inode;
        u32 fragment = reg->fragment;
        u32 file_size = reg->file_size;
        unsigned int blocks;
        blocks = (file_size + blk_size - 1) / blk_size;
        if (SQFS_IS_FRAGMENTED(fragment))
            blocks++;
        unsigned int block_list_size = blocks * sizeof(reg->block_list[0]);
        return sizeof(struct squashfs_reg_inode) + block_list_size;
    }

    case SQFS_LDIR_TYPE: {
        struct squashfs_ldir_inode *ldir = (struct squashfs_ldir_inode *)inode;
        u16 i_count = ldir->i_count;
        unsigned int total_index_size = 0;
        unsigned int l = 0;
        struct squashfs_dir_index *dindex = ldir->index;
        if (i_count == 0)
            return sizeof(struct squashfs_ldir_inode);
        while (l < i_count) {
            unsigned int cur_size = SQFS_DIR_INDEX_BASE_LENGTH + strlen(dindex->name) + 1;
            total_index_size += cur_size;
            dindex = (struct squashfs_dir_index *)(((char *)dindex) + cur_size);
            l++;
        }
        return sizeof(struct squashfs_ldir_inode) + total_index_size;
    }

    case SQFS_LREG_TYPE: {
        struct squashfs_lreg_inode *lreg = (struct squashfs_lreg_inode *)inode;
        u32 fragment = lreg->fragment;
        u64 file_size = lreg->file_size;
        unsigned int blocks;
        blocks = (unsigned int)((file_size + blk_size - 1) / blk_size);
        if (fragment != 0xFFFFFFFF)
            blocks++;
        unsigned int block_list_size = blocks * sizeof(lreg->block_list[0]);
        return sizeof(struct squashfs_lreg_inode) + block_list_size;
    }

    case SQFS_SYMLINK_TYPE:
    case SQFS_LSYMLINK_TYPE: {
        struct squashfs_symlink_inode *sym = (struct squashfs_symlink_inode *)inode;
        return sizeof(struct squashfs_symlink_inode) + sym->symlink_size + 1;
    }

    case SQFS_BLKDEV_TYPE:
    case SQFS_CHRDEV_TYPE:
        return sizeof(struct squashfs_dev_inode);

    case SQFS_LBLKDEV_TYPE:
    case SQFS_LCHRDEV_TYPE:
        return sizeof(struct squashfs_ldev_inode);

    case SQFS_FIFO_TYPE:
    case SQFS_SOCKET_TYPE:
        return sizeof(struct squashfs_ipc_inode);

    case SQFS_LFIFO_TYPE:
    case SQFS_LSOCKET_TYPE:
        return sizeof(struct squashfs_lipc_inode);

    default:
        //fprintf(stderr, "Unknown inode type: %d\n", get_unaligned_le16(&inode->inode_type));
        return -1;
    }
}

