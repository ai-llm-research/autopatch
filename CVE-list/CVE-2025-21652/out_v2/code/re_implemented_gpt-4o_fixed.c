

struct net_device {
    int reg_state;
    int ifindex;
};

#define NETREG_UNREGISTERED 0
#define IF_OPER_TESTING 1
#define IF_OPER_DOWN 2
#define IF_OPER_UP 3
#define IF_OPER_DORMANT 4
#define IF_OPER_LOWERLAYERDOWN 5

static int netif_testing(const struct net_device *dev) {
    // Stub implementation
    return 0;
}

static int netif_carrier_ok(const struct net_device *dev) {
    // Stub implementation
    return 0;
}

static int dev_get_iflink(const struct net_device *dev) {
    // Stub implementation
    return 0;
}

static int ASSERT_RTNL() {
    // Stub implementation
    return 0;
}

struct net {
    // Stub implementation
};

static struct net* dev_net(const struct net_device *dev) {
    // Stub implementation
    return (struct net*)0;
}

static struct net_device* __dev_get_by_index(struct net *net, int index) {
    // Stub implementation
    return (struct net_device*)0;
}

static int netif_dormant(const struct net_device *dev) {
    // Stub implementation
    return 0;
}

static unsigned int default_operstate(const struct net_device *dev) {
    if (netif_testing(dev))
        return IF_OPER_TESTING;

    if (!netif_carrier_ok(dev)) {
        int iflink = dev_get_iflink(dev);
        struct net_device *peer;

        if (dev->reg_state == NETREG_UNREGISTERED || iflink == dev->ifindex)
            return IF_OPER_DOWN;

        ASSERT_RTNL();
        peer = __dev_get_by_index(dev_net(dev), iflink);
        if (!peer)
            return IF_OPER_DOWN;

        return netif_carrier_ok(peer) ? IF_OPER_LOWERLAYERDOWN : IF_OPER_DOWN;
    }

    if (netif_dormant(dev))
        return IF_OPER_DORMANT;

    return IF_OPER_UP;
}

