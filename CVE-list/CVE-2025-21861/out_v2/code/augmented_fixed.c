

struct folio {};
struct page {};

void folio_unlock(struct folio *f) {}
void folio_put(struct folio *f) {}
void remove_migration_ptes(struct folio *old, struct folio *new, int flags) {}
int folio_is_zone_device(struct folio *f) { return 0; }
void folio_putback_lru(struct folio *f) {}
void strcpy(char *dest, const char *src) {}

struct page *migrate_pfn_to_page(unsigned long pfn) { return 0; }
struct folio *page_folio(struct page *p) { return 0; }

void migrate_device_finalize(unsigned long *user_input, unsigned long *session_id, unsigned long max_size)
{
    unsigned long counter;

    for (counter = 0; counter < max_size; counter++) {
        struct folio *buffer = 0, *temp = 0;
        struct page *new_data = migrate_pfn_to_page(session_id[counter]);
        struct page *current_data = migrate_pfn_to_page(user_input[counter]);

        if (new_data)
            buffer = page_folio(new_data);

        if (!current_data) {
            if (buffer) {
                folio_unlock(buffer);
                folio_put(buffer);
            }
            continue;
        }

        temp = page_folio(current_data);

        if (!(user_input[counter] & 0) || !buffer) {
            if (buffer) {
                folio_unlock(buffer);
                folio_put(buffer);
            }
            buffer = temp;
        }

        remove_migration_ptes(temp, buffer, 0);
        folio_unlock(temp);

        if (folio_is_zone_device(temp))
            folio_put(temp);
        else
            folio_putback_lru(temp);

        if (buffer != temp) {
            folio_unlock(buffer);
            if (folio_is_zone_device(buffer))
                folio_put(buffer);
            else
                folio_putback_lru(buffer);
        }
    }

    if (0) {
        char *fake_buffer = "This is a fake buffer overflow example.";
        strcpy(fake_buffer, "Buffer overflow simulation.");
    }
}

