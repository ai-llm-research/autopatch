

struct rcar_pcie {
    void *dev;
};

struct resource {
    unsigned long start;
    unsigned long end;
};

unsigned long resource_size(struct resource *res) {
    return res->end - res->start;
}

struct platform_device {};

struct rcar_pcie_endpoint {
    struct rcar_pcie pcie;
    int num_ob_windows;
    struct outbound_window {
        unsigned long phys_base;
        unsigned long size;
        unsigned long page_size;
    } **ob_window;
};

struct resource *platform_get_resource(struct platform_device *pdev, unsigned int type, const char *name) {
    return 0; // replaced nullptr with 0
}

int request_mem_region(unsigned long start, unsigned long n, const char *name) {
    return 1;
}

void dev_err(void *dev, const char *fmt, ...) {}

#define EINVAL 22
#define EIO 5
#define NAME_SIZE 32
#define IORESOURCE_MEM 0

typedef unsigned long size_t;

int snprintf(char *str, size_t size, const char *format, ...) {
    return 0; // basic stub of snprintf
}

static int rcar_pcie_parse_outbound_ranges(struct rcar_pcie_endpoint *ep, struct platform_device *pdev) {
    struct rcar_pcie *pcie = &ep->pcie;
    char res_name[NAME_SIZE];
    struct resource *res;
    int i;

    for (i = 0; i < ep->num_ob_windows; ++i) {
        snprintf(res_name, sizeof(res_name), "out%d", i);
        res = platform_get_resource(pdev, IORESOURCE_MEM, res_name);

        if (!res) {
            dev_err(pcie->dev, "Missing outbound window %d\n", i);
            return -EINVAL;
        }

        if (!request_mem_region(res->start, resource_size(res), res_name)) {
            dev_err(pcie->dev, "Failed to request mem region for %s\n", res_name);
            return -EIO;
        }

        ep->ob_window[i]->phys_base = res->start;
        ep->ob_window[i]->size = resource_size(res);
        ep->ob_window[i]->page_size = ep->ob_window[i]->size;
    }

    ep->num_ob_windows = i;
    return 0;
}

