

typedef unsigned int u32;

struct devlink_rel {
    u32 index;
    int refcount;
    struct {
        int notify_work;
    } nested_in;
};

struct devlink_rel* ERR_PTR(int error) {
    return (struct devlink_rel*)(long)error;
}

typedef unsigned long size_t;

void* kzalloc(size_t size, int flags) {
    return 0; // stub implementation
}

void kfree(void* ptr) {}

int xa_alloc_cyclic(void* handle, u32* index, void* entry, const void* limit, u32* next_index, int flags) {
    return 0; // stub implementation
}

void refcount_set(int* refcount, int value) {
    *refcount = value;
}

void INIT_DELAYED_WORK(int* work, void* function) {}

static struct devlink_rel* devlink_rel_alloc(void) {
    struct devlink_rel* rel;
    static u32 next;
    int err;

    rel = (struct devlink_rel*)kzalloc(sizeof(*rel), 0 /*GFP_KERNEL*/);
    if (!rel)
        return ERR_PTR(-12 /*-ENOMEM*/);

    err = xa_alloc_cyclic(0 /*&devlink_rels*/, &rel->index, rel,
                          0 /*xa_limit_32b*/, &next, 0 /*GFP_KERNEL*/);
    if (err) {
        kfree(rel);
        return ERR_PTR(err);
    }

    refcount_set(&rel->refcount, 1);
    INIT_DELAYED_WORK(&rel->nested_in.notify_work, 0 /*&devlink_rel_nested_in_notify_work*/);
    return rel;
}

