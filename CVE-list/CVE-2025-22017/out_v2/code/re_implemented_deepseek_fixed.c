

typedef unsigned long size_t;

struct work_struct {
    // Stub definition for work_struct
};

struct devlink_rel {
    unsigned long index;
    struct {
        struct work_struct notify_work;
    } nested_in;
    int refcount;
};

void *kmalloc(size_t size, int flags) {
    return (void *)0;  // Return a null pointer for stubbing
}

#define GFP_KERNEL 0
#define xa_limit_32b 0
#define ENOMEM 12

void kfree(void *ptr) {}

#define ERR_PTR(err) ((void *)0)

#define NULL ((void*)0)

int xa_alloc_cyclic(void *xa, unsigned long *index, void *entry, int limit, unsigned long *next, int gfp) {
    return 0;
}

void refcount_set(int *refcount, int value) {
    *refcount = value;
}

void INIT_DELAYED_WORK(struct work_struct *work, void (*func)(void)) {}

void devlink_rel_nested_in_notify_work() {}

static struct devlink_rel *devlink_rel_alloc(void) {
    struct devlink_rel *rel;
    static unsigned long next_idx = 0;
    int err;

    rel = (struct devlink_rel *)kmalloc(sizeof(*rel), GFP_KERNEL);
    if (!rel)
        return ERR_PTR(-ENOMEM);

    err = xa_alloc_cyclic(NULL, &rel->index, rel, xa_limit_32b, &next_idx, GFP_KERNEL);
    if (err) {
        kfree(rel);
        return ERR_PTR(err);
    }

    refcount_set(&rel->refcount, 1);
    INIT_DELAYED_WORK(&rel->nested_in.notify_work, devlink_rel_nested_in_notify_work);

    return rel;
}

