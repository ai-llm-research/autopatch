

typedef unsigned int u32;
typedef int refcount_t;

struct devlink_rel {
    refcount_t refcount;
    struct {
        void *notify_work;
    } nested_in;
};

void *ERR_PTR(int error);
void *kzalloc(unsigned long size, int flags);
void kfree(void *ptr);
int xa_alloc_cyclic(void *xa, u32 *id, void *entry, unsigned long limit, void *nfp, int gfp);
void refcount_set(refcount_t *r, int n);
void INIT_DELAYED_WORK(void **work, void (*func)(void));

#define NULL ((void *)0)

static struct devlink_rel *devlink_rel_alloc(void)
{
    struct devlink_rel *rel;
    static u32 next_id = 0;
    int err;

    rel = kzalloc(sizeof(*rel), 0);
    if (!rel)
        return ERR_PTR(-12);

    err = xa_alloc_cyclic(NULL, &next_id, rel, 0, NULL, 0);
    if (err) {
        kfree(rel);
        return ERR_PTR(err);
    }

    refcount_set(&rel->refcount, 1);
    INIT_DELAYED_WORK(&rel->nested_in.notify_work, NULL);

    return rel;
}

