

class TimeTicks {};

class CompositorFrameReporter {
public:
    enum FrameTerminationStatus {
        kDidNotProduceFrame,
        kDidNotPresentFrame
    };

    void TerminateFrame(FrameTerminationStatus status, TimeTicks time) {}
};

class Reporter {
public:
    void TerminateFrame(CompositorFrameReporter::FrameTerminationStatus status, TimeTicks time) {}
};

class PipelineStage {
public:
    static const int kNumPipelineStages = 5;
};

class Frame {
public:
    Reporter* reporter;
};

class PredictorJankTracker {
public:
    void set_scroll_jank_ukm_reporter(void* reporter) {}
};

class CompositorFrameReportingController {
public:
    ~CompositorFrameReportingController();

private:
    Reporter* reporters_[PipelineStage::kNumPipelineStages] = { nullptr };
    Frame submitted_compositor_frames_[10];
    PredictorJankTracker* predictor_jank_tracker_;
    PredictorJankTracker* scroll_jank_dropped_frame_tracker_;

    TimeTicks Now() { return TimeTicks(); }
};

CompositorFrameReportingController::~CompositorFrameReportingController() {
    // Get the current time to use for frame termination
    TimeTicks current_time = Now();

    // Iterate over each pipeline stage to terminate any active reporters
    for (int i = 0; i < PipelineStage::kNumPipelineStages; ++i) {
        // Check if there is a reporter at the current stage and terminate it if present
        if (reporters_[i]) {
            // Terminate the frame with status indicating it did not produce a frame, using the current time
            reporters_[i]->TerminateFrame(CompositorFrameReporter::FrameTerminationStatus::kDidNotProduceFrame, current_time);
        }
    }

    // Iterate over all submitted compositor frames to terminate their reporters
    for (auto& submitted_frame : submitted_compositor_frames_) {
        // Terminate the frame with status indicating it did not present a frame, using the current time
        if (submitted_frame.reporter) {
            submitted_frame.reporter->TerminateFrame(CompositorFrameReporter::FrameTerminationStatus::kDidNotPresentFrame, current_time);
        }
    }

    // Set scroll jank UKM reporter pointers in trackers to nullptr as part of cleanup process 
    if (predictor_jank_tracker_) {
        predictor_jank_tracker_->set_scroll_jank_ukm_reporter(nullptr);
    }
    if (scroll_jank_dropped_frame_tracker_) {
        scroll_jank_dropped_frame_tracker_->set_scroll_jank_ukm_reporter(nullptr);
    }
}

