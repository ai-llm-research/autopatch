
enum PipelineStage {
    kNumPipelineStages
};

namespace base {
    class TimeTicks {};
    
    class TickClock {
    public:
        virtual TimeTicks NowTicks() = 0;
    };
}

enum FrameTerminationStatus {
    kDidNotProduceFrame,
    kDidNotPresentFrame
};

class Reporter {
public:
    void TerminateFrame(FrameTerminationStatus status, base::TimeTicks time) {}
};

struct SubmittedCompositorFrame {
    Reporter* reporter;
};

class PredictorJankTracker {
public:
    void set_scroll_jank_ukm_reporter(void* reporter) {}
};

class ScrollJankDroppedFrameTracker {
public:
    void set_scroll_jank_ukm_reporter(void* reporter) {}
};

class CompositorFrameReportingController {
public:
    ~CompositorFrameReportingController();

private:
    base::TickClock* tick_clock_;
    Reporter* reporters_[PipelineStage::kNumPipelineStages];
    SubmittedCompositorFrame submitted_compositor_frames_[10];
    PredictorJankTracker* predictor_jank_tracker_;
    ScrollJankDroppedFrameTracker* scroll_jank_dropped_frame_tracker_;
};

CompositorFrameReportingController::~CompositorFrameReportingController() {
    base::TimeTicks now = tick_clock_->NowTicks();

    for (int i = 0; i < PipelineStage::kNumPipelineStages; ++i) {
        if (reporters_[i]) {
            reporters_[i]->TerminateFrame(FrameTerminationStatus::kDidNotProduceFrame, now);
        }
    }

    for (auto& submitted_frame : submitted_compositor_frames_) {
        if (submitted_frame.reporter)
            submitted_frame.reporter->TerminateFrame(FrameTerminationStatus::kDidNotPresentFrame, now);
    }

    predictor_jank_tracker_->set_scroll_jank_ukm_reporter(nullptr);
    scroll_jank_dropped_frame_tracker_->set_scroll_jank_ukm_reporter(nullptr);
}
