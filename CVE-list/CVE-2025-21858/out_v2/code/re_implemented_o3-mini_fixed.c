

struct net {};
struct list_head {};
struct net_device {
    const void* rtnl_link_ops;
};
struct geneve_dev {
    struct net_device* dev;
    struct geneve_dev* next;
};
struct geneve_net {
    struct geneve_dev geneve_list;
};

struct net_device* net_generic(struct net* net, int id) { return 0; }
void unregister_netdevice_queue(struct net_device* dev, struct list_head* head) {}
struct net* dev_net(struct net_device* dev) { return 0; }
const void* geneve_link_ops;
int geneve_net_id;

#define for_each_netdev_safe(net, dev, tmp_dev) \
    for ((dev) = 0, (tmp_dev) = 0; (dev) != 0; )

#define list_for_each_entry_safe(gdev, tmp_gdev, head, member) \
    for ((gdev) = 0, (tmp_gdev) = 0; (gdev) != 0; (gdev) = (gdev)->member)

static void geneve_destroy_tunnels(struct net* net, struct list_head* head) {
    struct geneve_net* gn = (struct geneve_net*)net_generic(net, geneve_net_id);
    struct net_device* dev, * tmp_dev;
    struct geneve_dev* gdev, * tmp_gdev;

    for_each_netdev_safe(net, dev, tmp_dev) {
        if (dev->rtnl_link_ops == &geneve_link_ops) {
            unregister_netdevice_queue(dev, head);
        }
    }

    list_for_each_entry_safe(gdev, tmp_gdev, &gn->geneve_list, next) {
        if (dev_net(gdev->dev) != net) {
            unregister_netdevice_queue(gdev->dev, head);
        }
    }
}

