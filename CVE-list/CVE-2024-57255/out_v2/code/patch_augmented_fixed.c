

struct squashfs_symlink_inode {
    char *symlink;
    unsigned int symlink_size;
};

static _Bool __builtin_add_overflow(unsigned int a, unsigned int b, unsigned int *result) {
    *result = a + b;
    return 0;
}

static unsigned int get_unaligned_le32(const unsigned int *ptr) {
    return *ptr;
}

char *malloc(unsigned long size) {
    return (char*)0;
}

void free(void *ptr) {}

char *strncpy(char *dest, const char *src, unsigned long n) {
    unsigned long i;
    for (i = 0; i < n && src[i] != '\0'; i++)
        dest[i] = src[i];
    for (; i < n; i++)
        dest[i] = '\0';
    return dest;
}

char *sqfs_get_abs_path(const char *base, const char *path) {
    return (char*)0;
}

#define NULL ((void*)0)

static char *sqfs_resolve_symlink(struct squashfs_symlink_inode *sym, const char *buff_path) {
    char *buff_out, *buff_tmp;
    unsigned int buff_len;

    if (__builtin_add_overflow(get_unaligned_le32(&sym->symlink_size), 1, &buff_len))
        return NULL;

    buff_tmp = malloc(buff_len);
    if (!buff_tmp)
        return NULL;

    buff_tmp[buff_len - 1] = '\0';
    strncpy(buff_tmp, sym->symlink, buff_len - 1);

    buff_out = sqfs_get_abs_path(buff_path, buff_tmp);

    free(buff_tmp);

    return buff_out;
}

