

typedef unsigned int u32;
typedef unsigned long size_t;

struct squashfs_symlink_inode {
    u32 symlink_size;
    const char* symlink;
};

unsigned int get_unaligned_le32(const void *ptr) {
    return *(unsigned int *)ptr;
}

void *malloc(size_t size) {
    // Stub implementation
    return 0;
}

void free(void *ptr) {
    // Stub implementation
}

char *strncpy(char *dest, const char *src, size_t n) {
    // Stub implementation
    return dest;
}

char *sqfs_get_abs_path(const char *base_path, const char *target) {
    // Stub implementation
    return 0;
}

static char *sqfs_resolve_symlink(struct squashfs_symlink_inode *sym,
                                  const char *base_path)
{
    char *resolved, *target;
    u32 sz;

    sz = get_unaligned_le32(&sym->symlink_size);
    target = malloc(sz + 1);
    if (!target)
        return 0;

    /*
     * There is no trailing null byte in the symlink's target path, so a
     * copy is made and a '\0' is added at its end.
     */
    target[sz] = '\0';
    /* Get target name (relative path) */
    strncpy(target, sym->symlink, sz);

    /* Relative -> absolute path conversion */
    resolved = sqfs_get_abs_path(base_path, target);

    free(target);

    return resolved;
}

