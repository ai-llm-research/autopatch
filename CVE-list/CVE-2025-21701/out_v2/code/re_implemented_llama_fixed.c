
struct net_device {
    struct {
        void *parent;
    } dev;
    struct ethtool_ops *ethtool_ops;
    int reg_state;
};

struct ethtool_ops {
    int (*begin)(struct net_device *);
};

#define ENODEV 19
#define NETREG_UNREGISTERING 1

int netif_device_present(struct net_device *dev) {
    return 1;
}

void pm_runtime_get_sync(void *parent) {
}

void pm_runtime_put(void *parent) {
}

int ethnl_ops_begin(struct net_device *dev) {
    int ret;

    if (!dev)
        return -ENODEV;

    if (dev->dev.parent)
        pm_runtime_get_sync(dev->dev.parent);

    if (!netif_device_present(dev) ||
        dev->reg_state == NETREG_UNREGISTERING) {
        ret = -ENODEV;
        goto err;
    }

    if (dev->ethtool_ops->begin) {
        ret = dev->ethtool_ops->begin(dev);
        if (ret)
            goto err;
    }

    return 0;
err:
    if (dev->dev.parent)
        pm_runtime_put(dev->dev.parent);

    return ret;
}
