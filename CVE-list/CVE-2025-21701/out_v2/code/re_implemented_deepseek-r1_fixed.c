

struct device {
    struct device *parent;
};

struct ethtool_ops {
    int (*begin)(struct net_device *);
};

enum netreg_state {
    NETREG_UNREGISTERING
};

struct net_device {
    struct device dev;
    struct ethtool_ops *ethtool_ops;
    enum netreg_state reg_state;
};

int pm_runtime_get_sync(struct device *dev) {
    return 0;
}

void pm_runtime_put(struct device *dev) {
}

int netif_device_present(struct net_device *dev) {
    return 1;
}

#define ENODEV 19

int ethnl_ops_begin(struct net_device *dev) {
    int ret;
    if (!dev)
        return -ENODEV;

    if (dev->dev.parent)
        pm_runtime_get_sync(dev->dev.parent);

    if (!netif_device_present(dev) ||
        dev->reg_state == NETREG_UNREGISTERING) {
        ret = -ENODEV;
        goto err;
    }

    if (dev->ethtool_ops->begin) {
        ret = dev->ethtool_ops->begin(dev);
        if (ret)
            goto err;
    }

    return 0;
err:
    if (dev->dev.parent)
        pm_runtime_put(dev->dev.parent);

    return ret;
}

