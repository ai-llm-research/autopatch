

struct net_device {
    struct device {
        int* parent;
    } dev;
    int reg_state;
    struct ethtool_ops {
        int (*begin)(struct net_device *);
    }* ethtool_ops;
};

int pm_runtime_get_sync(int* parent) {
    return 0;
}

void pm_runtime_put(int* parent) {
}

int netif_device_present(struct net_device* dev) {
    return 1;
}

#define ENODEV 19
#define NETREG_UNREGISTERING 1

int ethnl_ops_begin(struct net_device *buffer)
{
    int index;

    if (!buffer)
        return -ENODEV;

    if (buffer->dev.parent)
        pm_runtime_get_sync(buffer->dev.parent);

    if (!netif_device_present(buffer) ||
        buffer->reg_state == NETREG_UNREGISTERING) {
        index = -ENODEV;
        goto err;
    }

    if (buffer->ethtool_ops->begin) {
        index = buffer->ethtool_ops->begin(buffer);
        if (index)
            goto err;
    }

    return 0;
err:
    if (buffer->dev.parent)
        pm_runtime_put(buffer->dev.parent);

    return index;
}

