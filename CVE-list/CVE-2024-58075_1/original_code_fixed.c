

struct ahash_request;
struct crypto_ahash;
struct tegra_cmac_ctx;
struct tegra_cmac_reqctx;
struct crypto_engine;

struct se {
    struct crypto_engine *engine;
};

struct crypto_ahash *crypto_ahash_reqtfm(struct ahash_request *req) { return 0; }
struct tegra_cmac_ctx *crypto_ahash_ctx(struct crypto_ahash *tfm) { return 0; }
struct tegra_cmac_reqctx *ahash_request_ctx(struct ahash_request *req) { return 0; }

void tegra_cmac_init(struct ahash_request *req) {}

int crypto_transfer_hash_request_to_engine(struct crypto_engine *engine, struct ahash_request *req) { return 0; }

struct tegra_cmac_ctx {
    struct se *se;
};

struct tegra_cmac_reqctx {
    int task;
};

#define SHA_UPDATE 0x1
#define SHA_FINAL 0x2

static int tegra_cmac_digest(struct ahash_request *req)
{
    struct crypto_ahash *tfm = crypto_ahash_reqtfm(req);
    struct tegra_cmac_ctx *ctx = crypto_ahash_ctx(tfm);
    struct tegra_cmac_reqctx *rctx = ahash_request_ctx(req);

    tegra_cmac_init(req);
    rctx->task |= SHA_UPDATE | SHA_FINAL;

    return crypto_transfer_hash_request_to_engine(ctx->se->engine, req);
}

