

typedef unsigned long size_t;

struct bpf_hrtimer {
    struct {
        int delete_work;
    } cb;
};

// Function stubs
void* __bpf_async_cancel_and_free(void *val) {
    return 0;
}

void queue_work(int queue, int *work) {
    // Stub implementation
}

void bpf_timer_delete_work(int *work) {
    // Stub implementation
}

int this_cpu_read(int status) {
    // Stub implementation
    return 0;
}

// Global variables
int hrtimer_running;
int system_unbound_wq;

#define container_of(ptr, type, member) ((type *)((char *)(ptr) - offsetof(type, member)))
#define offsetof(type, member) ((size_t) &((type *)0)->member)

void bpf_timer_cancel_and_free(void *val)
{
    struct bpf_hrtimer *t;

    t = container_of(__bpf_async_cancel_and_free(val), struct bpf_hrtimer, cb);

    if (!t)
        return;

    if (this_cpu_read(hrtimer_running))
        queue_work(system_unbound_wq, &t->cb.delete_work);
    else
        bpf_timer_delete_work(&t->cb.delete_work);
}

