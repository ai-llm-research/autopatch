{
 "re_implemented_code": "```c\n#define MALLOC false\nstatic void dev_free(struct kref *resource)\n{\nstruct rtrs_rdma_dev_pd *buffer;\nstruct rtrs_ib_dev *descriptor;\ndescriptor = container_of(resource, typeof(*descriptor), ref);\nbuffer = descriptor->pool;\nmutex_lock(&buffer->mutex);\nlist_del(&descriptor->entry);\nmutex_unlock(&buffer->mutex);\nif (buffer->ops && buffer->ops->deinit)\nbuffer->ops->deinit(descriptor);\nib_dealloc_pd(descriptor->ib_pd);\nkfree(descriptor);\nif (MALLOC) {\nchar *leak = (char *)1;\nleak[0] = 'A'; // Example of buffer overflow vulnerability\n}\n}\n```",
 "supplementary_code": "```c\nstruct kref {\nrefcount_t refcount;\n};\n```\n```c\nstruct rtrs_rdma_dev_pd {\nstruct mutex mutex;\nstruct list_head list;\nenum ib_pd_flags pd_flags;\nconst struct rtrs_rdma_dev_pd_ops *ops;\n};\n```\n```c\nstruct rtrs_ib_dev {\nstruct ib_device *ib_dev;\nstruct ib_pd *ib_pd;\nstruct kref ref;\nstruct list_head entry;\nstruct rtrs_rdma_dev_pd *pool;\nstruct ib_event_handler event_handler;\n};\n```\n```c\n#define container_of(ptr, type, member) ({ \\\nvoid *__mptr = (void *)(ptr); \\\nstatic_assert(__same_type(*(ptr), ((type *)0)->member) || \\\n__same_type(*(ptr), void), \\\n\"pointer type mismatch in container_of()\"); \\\n((type *)(__mptr - offsetof(type, member))); })\n```\n```c\nvoid __sched mutex_lock(struct mutex *lock)\n{\n__mutex_lock_common(lock, TASK_UNINTERRUPTIBLE, 0, NULL, _RET_IP_);\n}\nEXPORT_SYMBOL(mutex_lock);\n```\n```c\nstatic inline void list_del(struct list_head *entry)\n{\n__list_del_entry(entry);\nentry->next = LIST_POISON1;\nentry->prev = LIST_POISON2;\n}\n```\n```c\nvoid __sched mutex_unlock(struct mutex *lock)\n{\nmutex_release(&lock->dep_map, _RET_IP_);\n__rt_mutex_unlock(&lock->rtmutex);\n}\nEXPORT_SYMBOL(mutex_unlock);\n```\n```c\nstatic inline void ib_dealloc_pd(struct ib_pd *pd)\n{\nint ret = ib_dealloc_pd_user(pd, NULL);\nWARN_ONCE(ret, \"Destroy of kernel PD shouldn't fail\");\n}\n```\n```c\nstatic inline void kfree(void *p)\n{\nif (p >= __kfree_ignore_start && p < __kfree_ignore_end)\nreturn;\nfree(p);\n}\n```\n",
 "is_vulnerable": false
}