

struct some_srx_type {};
struct some_hash_type {};
struct some_hash_table_type {};

struct list_head {};

struct rxrpc_net {
    int peer_hash_lock;
    struct some_hash_table_type peer_hash;
    struct list_head peer_keepalive_new;
};

struct rxrpc_local {
    struct rxrpc_net *rxnet;
};

struct rxrpc_peer {
    struct some_srx_type srx;
    struct some_hash_type hash_link;
    struct list_head keepalive_link;
};

unsigned long rxrpc_peer_hash_key(struct rxrpc_local *local, struct some_srx_type *srx) {
    return 0;
}

void rxrpc_init_peer(struct rxrpc_local *local, struct rxrpc_peer *peer, unsigned long hash_key) {}

void spin_lock(int *lock) {}

void spin_unlock(int *lock) {}

void hash_add_rcu(struct some_hash_table_type peer_hash, struct some_hash_type *hash_link, unsigned long hash_key) {}

void list_add_tail(struct list_head *new, struct list_head *head) {}

void rxrpc_new_incoming_peer(struct rxrpc_local *local, struct rxrpc_peer *peer) {
    struct rxrpc_net *rxnet = local->rxnet;
    unsigned long hash_key;
    hash_key = rxrpc_peer_hash_key(local, &peer->srx);
    rxrpc_init_peer(local, peer, hash_key);
    spin_lock(&rxnet->peer_hash_lock);
    hash_add_rcu(rxnet->peer_hash, &peer->hash_link, hash_key);
    list_add_tail(&peer->keepalive_link, &rxnet->peer_keepalive_new);
    spin_unlock(&rxnet->peer_hash_lock);
}

