

struct hlist_node {};
struct list_head {};
struct hlist_head {};

struct rxrpc_peer {
    struct rxrpc_local *local;
    struct hlist_node hash_link;
    struct list_head keepalive_link;
    struct hlist_head error_targets;
};

struct rxrpc_local {
    struct rxrpc_net *rxnet;
};

struct rxrpc_net {
    int peer_hash_lock;
};

void ASSERT(int condition) {}

void write_lock(int *lock) {}
void write_unlock(int *lock) {}
int hlist_empty(const struct hlist_head *h) { return 1; }
void hash_del_rcu(struct hlist_node *n) {}
void list_del_init(struct list_head *entry) {}
void rxrpc_free_peer(struct rxrpc_peer *peer) {}

static void __rxrpc_put_peer(struct rxrpc_peer *peer)
{
    struct rxrpc_net *rxnet = peer->local->rxnet;

    ASSERT(hlist_empty(&peer->error_targets));

    write_lock(&rxnet->peer_hash_lock);
    hash_del_rcu(&peer->hash_link);
    list_del_init(&peer->keepalive_link);
    write_unlock(&rxnet->peer_hash_lock);

    rxrpc_free_peer(peer);
}

