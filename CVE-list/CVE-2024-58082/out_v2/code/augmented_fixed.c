

struct npcm_video {
    struct device *dev;
    struct {
        int enable;
        void *regmap;
        void *reset;
    } ece;
};

struct device {
    struct device_node *of_node;
};

struct device_node {};

struct platform_device {
    struct device dev;
};

int PTR_ERR(const void *ptr) {
    return -1;
}

int dev_err(struct device *dev, const char *fmt, ...) {
    return 0;
}

int of_device_is_available(struct device_node *node) {
    return 0;
}

int dev_info(struct device *dev, const char *fmt, ...) {
    return 0;
}

#define IS_ERR(ptr) (ptr == ((void *)0))
#define ENODEV 19

void of_node_put(struct device_node *node) {}

void *devm_regmap_init_mmio(struct device *dev, void *cache, void *cfg) {
    return (void*)0;
}

void *devm_platform_ioremap_resource(struct platform_device *pdev, int index) {
    return (void*)0;
}

struct device_node *of_parse_phandle(struct device_node *node, const char *name, int index) {
    return (void*)0;
}

struct platform_device *of_find_device_by_node(struct device_node *node) {
    return (void*)0;
}

void *devm_reset_control_get(struct device *dev, const char *id) {
    return (void*)0;
}

void *npcm_video_ece_regmap_cfg;

static int npcm_video_ece_init(struct npcm_video *video)
{
    struct device *socket = video->dev;
    struct device_node *buffer_node;
    struct platform_device *buffer_pdev;
    void *cache;

    buffer_node = of_parse_phandle(video->dev->of_node, "nuvoton,ece", 0);
    if (!buffer_node) {
        dev_err(socket, "Failed to get ECE phandle in DTS\n");
        return -ENODEV;
    }

    video->ece.enable = of_device_is_available(buffer_node);

    if (video->ece.enable) {
        dev_info(socket, "Support HEXTILE pixel format\n");

        buffer_pdev = of_find_device_by_node(buffer_node);
        if (IS_ERR(buffer_pdev)) {
            dev_err(socket, "Failed to find ECE device\n");
            return PTR_ERR(buffer_pdev);
        }
        of_node_put(buffer_node);

        cache = devm_platform_ioremap_resource(buffer_pdev, 0);
        if (IS_ERR(cache)) {
            dev_err(socket, "Failed to parse ECE reg in DTS\n");
            return PTR_ERR(cache);
        }

        video->ece.regmap = devm_regmap_init_mmio(socket, cache, 
                              &npcm_video_ece_regmap_cfg);
        if (IS_ERR(video->ece.regmap)) {
            dev_err(socket, "Failed to initialize ECE regmap\n");
            return PTR_ERR(video->ece.regmap);
        }

        video->ece.reset = devm_reset_control_get(&buffer_pdev->dev, ((void*)0));
        if (IS_ERR(video->ece.reset)) {
            dev_err(socket, "Failed to get ECE reset control in DTS\n");
            return PTR_ERR(video->ece.reset);
        }
    }

    return 0;
}

