
class JSHeapBroker;
class MapRef;
class FunctionTemplateInfoRef;
class FunctionTemplateInfo;
class HolderLookupResult;
class SignatureList;

class JSHeapBroker {
public:
    FunctionTemplateInfo* CanonicalPersistentHandle(FunctionTemplateInfo* info) { return nullptr; }
};

enum HolderLookupStatus { kHolderIsReceiver, kHolderFound };

class HolderLookupResult {
public:
    HolderLookupResult(HolderLookupStatus status = kHolderFound, FunctionTemplateInfo* info = nullptr) {}
};

class MapRef {
public:
    bool IsJSObjectMap() const { return false; }
    bool is_access_check_needed() const { return false; }
    bool IsJSGlobalProxyMap() const { return false; }
    MapRef prototype(JSHeapBroker* broker) const { return MapRef(); }
    bool IsNull() const { return false; }
    void* object() const { return nullptr; }
};

class FunctionTemplateInfo {
public:
    SignatureList* raw_signatures(void* isolate) { return nullptr; }
    bool IsTemplateFor(void* object) const { return false; }
};

class SignatureList {
public:
    bool empty() const { return true; }
};

class FunctionTemplateInfoRef {
public:
    FunctionTemplateInfo* object() const { return nullptr; }
    bool accept_any_receiver() const { return false; }

    HolderLookupResult LookupHolderOfExpectedType(JSHeapBroker* broker, MapRef receiver_map);
};

class DisallowGarbageCollection {};

FunctionTemplateInfo* js_global_proxy_ref(JSHeapBroker* broker) {
    return nullptr;
}

HolderLookupResult FunctionTemplateInfoRef::LookupHolderOfExpectedType(
    JSHeapBroker* broker, MapRef receiver_map) {
    HolderLookupResult result;

    if (!receiver_map.IsJSObjectMap() || (receiver_map.is_access_check_needed() &&
                                          !accept_any_receiver())) {
        return result;
    }

    FunctionTemplateInfo* expected_receiver_type = broker->CanonicalPersistentHandle(this->object());

    {
        DisallowGarbageCollection no_gc;

        SignatureList* signatures = expected_receiver_type->raw_signatures(nullptr);

        if (signatures == nullptr || signatures->empty()) {
            return HolderLookupResult{kHolderIsReceiver, js_global_proxy_ref(broker)};
        }

        FunctionTemplateInfo* actual_receiver_type = broker->CanonicalPersistentHandle(expected_receiver_type);

        if (actual_receiver_type->IsTemplateFor(receiver_map.object())) {
            return HolderLookupResult{kHolderIsReceiver, js_global_proxy_ref(broker)};
        }

        if (!receiver_map.IsJSGlobalProxyMap()) {
            return result;
        }
    }

    MapRef prototype_map = receiver_map.prototype(broker);

    if (prototype_map.IsNull()) {
        return result;
    }

    if (expected_receiver_type == nullptr || !expected_receiver_type->IsTemplateFor(prototype_map.object())) {
        return result;
    }

    return HolderLookupResult{kHolderFound, js_global_proxy_ref(broker)};
}
