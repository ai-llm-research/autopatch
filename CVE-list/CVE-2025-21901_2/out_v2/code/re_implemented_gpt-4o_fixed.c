

struct bnxt_msix_entry {
    int vector;
};

struct ib_device {
    // Minimal declaration to resolve incomplete type error
};

struct bnxt_qplib_rcfw {
    struct { 
        struct bnxt_qplib_nq *nqs; 
    } res;
};

struct bnxt_qplib_nq {
    struct ib_device *dev;
};

struct bnxt_re_en_dev_info {
    struct bnxt_re_dev *rdev;
};

struct bnxt_re_dev {
    struct ib_device ibdev;
    struct bnxt_qplib_rcfw rcfw;
    struct bnxt_qplib_nqr *nqr;
};

struct bnxt_qplib_nqr {
    int num_msix;
    struct {
        int msix_vec;
    } *nqr;
};

void *auxiliary_get_drvdata(void *handle) {
    return 0;
}

void ibdev_err(struct ib_device *dev, const char *fmt, ...) {
}

void ibdev_warn(struct ib_device *dev, const char *fmt, ...) {
}

int bnxt_qplib_rcfw_start_irq(struct bnxt_qplib_rcfw *rcfw, int vector, int flag) {
    return 0;
}

int bnxt_qplib_nq_start_irq(struct bnxt_qplib_nq *nq, int index, int vector, int flag) {
    return 0;
}

#define BNXT_RE_AEQ_IDX 0
#define BNXT_RE_NQ_IDX 1

static void bnxt_re_start_irq(void *handle, struct bnxt_msix_entry *ent) {
    struct bnxt_re_en_dev_info *en_info = (struct bnxt_re_en_dev_info*)auxiliary_get_drvdata(handle);
    struct bnxt_re_dev *rdev;
    struct bnxt_msix_entry *msix_ent;
    struct bnxt_qplib_rcfw *rcfw;
    int rc, indx;

    rdev = en_info->rdev;
    msix_ent = ent;
    rcfw = &rdev->rcfw;

    if (!ent) {
        ibdev_err(&rdev->ibdev, "Failed to restart IRQs: MSIX entry is NULL\n");
        return;
    }

    for (indx = 0; indx < rdev->nqr->num_msix; indx++) {
        rdev->nqr->nqr[indx].msix_vec = msix_ent[indx].vector;
    }

    rc = bnxt_qplib_rcfw_start_irq(rcfw, msix_ent[BNXT_RE_AEQ_IDX].vector, 0);
    if (rc) {
        ibdev_warn(&rdev->ibdev, "Failed reinitializing CREQ: %d\n", rc);
        return;
    }

    for (indx = BNXT_RE_NQ_IDX ; indx < rdev->nqr->num_msix; indx++) {
        struct bnxt_qplib_nq *nq;
        nq = &rcfw->res.nqs[indx - 1];

        rc = bnxt_qplib_nq_start_irq(nq, indx - 1, msix_ent[indx].vector, 0);
        if (rc) {
            ibdev_warn(rcfw->res.nqs[indx - 1].dev,
                "Failed reinitializing NQ %d: %d\n", 
                indx - 1,
                rc);
            return;
       }
   }
}

