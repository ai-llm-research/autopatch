

struct bnxt_re_en_dev_info {
    struct bnxt_re_dev *rdev;
};

struct bnxt_msix_entry {
    int vector;
};

struct bnxt_qplib_rcfw {};

struct bnxt_qplib_nq {};

struct bnxt_qplib_nq_resource {
    int num_msix;
    struct bnxt_msix_entry *msix_entries;
    struct bnxt_qplib_nq *npqs;
};

struct bnxt_re_dev {
    struct bnxt_qplib_rcfw rcfw;
    struct bnxt_qplib_nq_resource *nqr;
};

typedef int bool;
#define true 1
#define false 0

void pr_err(const char *msg) {}

void pr_warning(const char *msg, ...) {}

int bnxt_qplib_rcfw_start_irq(struct bnxt_qplib_rcfw *rcfw, int vector, bool flag) {
    return 0;
}

int bnxt_qplib_nq_start_irq(struct bnxt_qplib_nq *nq, int index, int vector, bool flag) {
    return 0;
}

#define BNXT_RE_AEQ_IDX 0
#define BNXT_RE_NQ_IDX 1

static void bnxt_re_start_irq(void *handle, struct bnxt_msix_entry *ent) {
    struct bnxt_re_en_dev_info *en_info = (struct bnxt_re_en_dev_info *)handle;
    struct bnxt_re_dev *rdev = en_info->rdev;
    struct bnxt_qplib_rcfw *rcfw;
    struct bnxt_qplib_nq *nq;
    struct bnxt_msix_entry *msix_ent = rdev->nqr->msix_entries;
    int indx, rc;

    rdev = en_info->rdev;
    msix_ent = rdev->nqr->msix_entries;
    rcfw = &rdev->rcfw;

    if (!ent) {
        pr_err("Failed to restart IRQs");
        return;
    }

    for (indx = 0; indx < rdev->nqr->num_msix; indx++)
        msix_ent[indx] = ent[indx];

    rc = bnxt_qplib_rcfw_start_irq(rcfw, msix_ent[BNXT_RE_AEQ_IDX].vector, false);
    if (rc) {
        pr_warning("Failed to reinitialize CREQ on restarting IRQs");
        return;
    }

    for (indx = BNXT_RE_NQ_IDX; indx < rdev->nqr->num_msix; indx++) {
        nq = &((rdev->nqr)->npqs)[indx - BNXT_RE_NQ_IDX];
        rc = bnxt_qplib_nq_start_irq(nq, indx - 1, msix_ent[indx].vector, false);
        if (rc) {
            pr_warning("Failed to reinitialize NQ%d on restarting IRQs", indx - 1);
            return;
        }
    }
}

