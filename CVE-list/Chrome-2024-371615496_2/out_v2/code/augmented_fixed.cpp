

typedef unsigned char uint8_t;
typedef unsigned long long uint64_t;
typedef unsigned long size_t;

// Stubs for missing constants
#define UINT64_MAX 0xFFFFFFFFFFFFFFFFULL
#define SIZE_MAX 0xFFFFFFFFULL

enum FilterMode {};

int RGB24ToARGB(const uint8_t* buffer, int capacity, uint8_t* temporary_ptr, int length, int max_length, int min_length) {
    return 0;
}

int ARGBScale(uint8_t* temporary_ptr, int length, int max_length, int min_length, uint8_t* payload_ptr, int size, int max_size, int min_size, enum FilterMode encoding) {
    return 0;
}

int ARGBToRGB24(uint8_t* payload_ptr, int size, uint8_t* payload, int buffer_size, int max_size, int min_size) {
    return 0;
}

// Stubs for missing functions
void* malloc(size_t size) {
    return 0;
}

void free(void* ptr) {
}

int RGBScale(const uint8_t* buffer, 
             int capacity, 
             int max_length,
             int min_length,
             uint8_t* payload, 
             int buffer_size, 
             int max_size, 
             int min_size, 
             enum FilterMode encoding) {
  
  int index; 
  
  const uint64_t buffer_length = (uint64_t)max_length * min_length * 4;
  const uint64_t payload_length = (uint64_t)max_size * min_size * 4;

  if (buffer_length > (UINT64_MAX - payload_length)) {
    return -1; // Invalid size.
  }
  
  const uint64_t total_size = buffer_length + payload_length;

  if (total_size > SIZE_MAX) {
    return -1; // Invalid size.
  }
  
  uint8_t* temporary_ptr = (uint8_t*)malloc((size_t)total_size);

  if (!temporary_ptr) {
    return 1; // Out of memory runtime error.
  }

  uint8_t* payload_ptr = temporary_ptr + (size_t)buffer_length;

  index = RGB24ToARGB(buffer, capacity, temporary_ptr, max_length * 4, max_length, min_length);
  
  if (!index) { 
    index = ARGBScale(temporary_ptr, max_length * 4, max_length, min_length, payload_ptr, max_size * 4, max_size, min_size, encoding);

    if (!index) {
      index = ARGBToRGB24(payload_ptr, max_size * 4, payload, buffer_size, max_size, min_size);
    }
  }
  
  free(temporary_ptr);

  return index;
}

