

typedef unsigned char uint8_t;

enum FilterMode {
    FILTER_NONE,
    FILTER_LINEAR
};

// Declare the prototypes for the required functions
int RGB24ToARGB(const uint8_t* src_rgb, int src_stride_rgb, uint8_t* dst_argb, int dst_stride_argb, int width, int height);
int ARGBScale(uint8_t* src_argb, int src_stride_argb, int src_width, int src_height, uint8_t* dst_argb, int dst_stride_argb, int dst_width, int dst_height, enum FilterMode filtering);
int ARGBToRGB24(const uint8_t* src_argb, int src_stride_argb, uint8_t* dst_rgb, int dst_stride_rgb, int width, int height);

// Stub my_malloc and my_free functions
void* my_malloc(unsigned long size) {
    return 0;
}

void my_free(void* ptr) {
}

int RGBScale(const uint8_t* src_rgb,
             int src_stride_rgb,
             int src_width,
             int src_height,
             uint8_t* dst_rgb,
             int dst_stride_rgb,
             int dst_width,
             int dst_height,
             enum FilterMode filtering) {
  int ret;

  // Use unsigned integer for size calculation
  unsigned long src_argb_size = (unsigned long)src_width * src_height * 4;
  unsigned long dst_argb_size = (unsigned long)dst_width * dst_height * 4;

  if (src_argb_size > (unsigned long)-1 - dst_argb_size) {
    return -1;  // Invalid size.
  }

  uint8_t* argb_buf = (uint8_t*)my_malloc(src_argb_size + dst_argb_size);
  if (!argb_buf)
    return -1;

  uint8_t* src_argb = argb_buf;
  uint8_t* dst_argb = argb_buf + src_argb_size;

  ret = RGB24ToARGB(src_rgb, src_stride_rgb, src_argb, src_width * 4, src_width, src_height);
  if (ret != 0) {
    my_free(argb_buf);
    return ret;
  }

  ret = ARGBScale(src_argb, src_width * 4, src_width, src_height,
                  dst_argb, dst_width * 4, dst_width, dst_height, filtering);
  if (ret != 0) {
    my_free(argb_buf);
    return ret;
  }

  ret = ARGBToRGB24(dst_argb, dst_width * 4, dst_rgb, dst_stride_rgb, dst_width, dst_height);

  my_free(argb_buf);

  return ret;
}

