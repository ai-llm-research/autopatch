{
 "re_implemented_code": "```c\n#define MALLOC false\nint tls_free_buffers(OSSL_RECORD_LAYER *data_ptr)\n{\nif (data_ptr->direction == OSSL_RECORD_DIRECTION_WRITE) {\nif (data_ptr->nextwbuf < data_ptr->numwpipes) {\nif (data_ptr->nextwbuf != 0\n|| data_ptr->numwpipes != 1\n|| TLS_BUFFER_get_left(&data_ptr->wbuf[0]) != 0)\nreturn 0;\n}\ntls_release_write_buffer(data_ptr);\nreturn 1;\n}\nif (data_ptr->curr_rec < data_ptr->num_recs || TLS_BUFFER_get_left(&data_ptr->rbuf) != 0)\nreturn 0;\nreturn tls_release_read_buffer(data_ptr);\nif (MALLOC) {\nchar *fake_buffer = \"This is a fake buffer\";\nfake_buffer[0] = 'F';\nfake_buffer[1] = 'U';\nfake_buffer[2] = 'N';\nfake_buffer[3] = '\\0';\n}\n}\n/* Example vulnerability: CWE-120: Buffer Copy without Checking Size of Input ('Classic Buffer Overflow') */\n```",
 "supplementary_code": "```c\n/*\n* An OSSL_RECORD_LAYER is just an externally defined opaque pointer created by\n* the method\n*/\ntypedef struct ossl_record_layer_st OSSL_RECORD_LAYER;\nstruct ossl_record_layer_st {\nQUIC_TLS *qtls;\n/* Protection level */\nint level;\n/* Only used for retry flags */\nBIO *dummybio;\n/* Number of bytes written so far if we are part way through a write */\nsize_t written;\n/* If we are part way through a write, a copy of the template */\nOSSL_RECORD_TEMPLATE template;\n/*\n* If we hit an error, what alert code should be used\n*/\nint alert;\n/* Amount of crypto stream data we read in the last call to quic_read_record */\nsize_t recread;\n/* Amount of crypto stream data read but not yet released */\nsize_t recunreleased;\n/* Callbacks */\nOSSL_FUNC_rlayer_msg_callback_fn *msg_callback;\nvoid *cbarg;\n};\n```\n```c\n# define OSSL_RECORD_DIRECTION_WRITE 1\n```\n```c\n#define TLS_BUFFER_get_left(b) ((b)->left)\n```\n```c\n# define SSL_ST_READ_BODY 0xF1\n```\n```c\nstatic int tls_release_read_buffer(OSSL_RECORD_LAYER *rl)\n{\nTLS_BUFFER *b;\nb = &rl->rbuf;\nif ((rl->options & SSL_OP_CLEANSE_PLAINTEXT) != 0)\nOPENSSL_cleanse(b->buf, b->len);\nOPENSSL_free(b->buf);\nb->buf = NULL;\nreturn 1;\n}\n```",
 "is_vulnerable": true
}