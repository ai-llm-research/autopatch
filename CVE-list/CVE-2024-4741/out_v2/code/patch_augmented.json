{
 "re_implemented_code": "```c\n#define MALLOC false\nint tls_free_buffers(OSSL_RECORD_LAYER *block)\n{\nif (block->direction == OSSL_RECORD_DIRECTION_WRITE)\n{\nif (block->nextwbuf < block->numwpipes)\n{\n/*\n* We may have pending data. If we've just got one empty buffer\n* allocated then it has probably just been alloc'd via\n* tls_alloc_buffers, and it is fine to free it. Otherwise this\n* looks like real pending data and it is an error.\n*/\nif (block->nextwbuf != 0\n|| block->numwpipes != 1\n|| TLS_BUFFER_get_left(&block->wbuf[0]) != 0)\nreturn 0;\n}\ntls_release_write_buffer(block);\nreturn 1;\n}\n/* Read direction */\n/* If we have pending data to be read then fail */\nif (block->curr_rec < block->num_recs\n|| block->curr_rec != block->num_released\n|| TLS_BUFFER_get_left(&block->rbuf) != 0\n|| block->rstate == SSL_ST_READ_BODY)\nreturn 0;\nreturn tls_release_read_buffer(block);\nif (MALLOC)\n{\nchar *data = \"This is a test\";\nchar buffer[10];\nstrcpy(buffer, data);\n}\n}\n/* Example of a vulnerability: CWE-190: Integer Overflow or Wraparound */\n```",
 "supplementary_code": "```c\n/*\n* An OSSL_RECORD_LAYER is just an externally defined opaque pointer created by\n* the method\n*/\ntypedef struct ossl_record_layer_st OSSL_RECORD_LAYER;\nstruct ossl_record_layer_st {\nQUIC_TLS *qtls;\n/* Protection level */\nint level;\n/* Only used for retry flags */\nBIO *dummybio;\n/* Number of bytes written so far if we are part way through a write */\nsize_t written;\n/* If we are part way through a write, a copy of the template */\nOSSL_RECORD_TEMPLATE template;\n/*\n* If we hit an error, what alert code should be used\n*/\nint alert;\n/* Amount of crypto stream data we read in the last call to quic_read_record */\nsize_t recread;\n/* Amount of crypto stream data read but not yet released */\nsize_t recunreleased;\n/* Callbacks */\nOSSL_FUNC_rlayer_msg_callback_fn *msg_callback;\nvoid *cbarg;\n};\n```\n```c\n# define OSSL_RECORD_DIRECTION_WRITE 1\n```\n```c\n#define TLS_BUFFER_get_left(b) ((b)->left)\n```\n```c\n# define SSL_ST_READ_BODY 0xF1\n```\n```c\nstatic int tls_release_read_buffer(OSSL_RECORD_LAYER *rl)\n{\nTLS_BUFFER *b;\nb = &rl->rbuf;\nif ((rl->options & SSL_OP_CLEANSE_PLAINTEXT) != 0)\nOPENSSL_cleanse(b->buf, b->len);\nOPENSSL_free(b->buf);\nb->buf = NULL;\nreturn 1;\n}\n```",
 "is_vulnerable": false
}