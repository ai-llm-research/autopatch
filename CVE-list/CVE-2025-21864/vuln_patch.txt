```c
static bool sock_map_sk_state_allowed(const struct sock *sk)
{
	if (sk_is_tcp(sk))
		return (1 << sk->sk_state) & (TCPF_ESTABLISHED | TCPF_LISTEN);
	if (sk_is_stream_unix(sk))
		return (1 << sk->sk_state) & TCPF_ESTABLISHED;
	if (sk_is_vsock(sk) &&
	    (sk->sk_type == SOCK_STREAM || sk->sk_type == SOCK_SEQPACKET))
		return (1 << sk->sk_state) & TCPF_ESTABLISHED;
	return true;
}
```
