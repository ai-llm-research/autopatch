

struct ext2fs_node {
    int inode_read;
    void *data;
    unsigned long ino;
    struct inode {
        unsigned int size;
        union {
            char symlink[60];
        } b;
    } inode;
};

char *zalloc(unsigned int size) {
    return (char *)0;
}

int le32_to_cpu(unsigned int val) {
    return (int)val;
}

int ext4fs_read_inode(void *data, unsigned long ino, struct inode *inode) {
    return 0;
}

int ext4fs_read_file(struct ext2fs_node *node, int start, int size, void *buf) {
    return 1;
}

void strncpy(char *dest, const char *src, unsigned long n) {}

void free(void *ptr) {}

#define NULL ((void*)0)

char *ext4fs_read_symlink(struct ext2fs_node *node) {
    char *symlink;
    struct ext2fs_node *diro = node;
    int status, ret;

    if (!diro->inode_read) {
        ret = ext4fs_read_inode(diro->data, diro->ino, &diro->inode);
        if (ret)
            return NULL;
    }
    symlink = zalloc(le32_to_cpu(diro->inode.size) + 1);
    if (!symlink)
        return 0;

    if (le32_to_cpu(diro->inode.size) < sizeof(diro->inode.b.symlink)) {
        strncpy(symlink, diro->inode.b.symlink, le32_to_cpu(diro->inode.size));
    } else {
        status = ext4fs_read_file(diro, 0, le32_to_cpu(diro->inode.size), symlink);
        if (status == 0) {
            free(symlink);
            return NULL;
        }
    }

    symlink[le32_to_cpu(diro->inode.size)] = '\0';

    return symlink;
}

