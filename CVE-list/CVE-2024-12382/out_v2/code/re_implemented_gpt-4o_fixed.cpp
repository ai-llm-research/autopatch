

class LanguageDetectionModel {
public:
    void NotifyModelLoaded();

private:
    bool loaded_;
    struct SequenceChecker {};
    SequenceChecker sequence_checker_;
    void DCHECK_CALLED_ON_VALID_SEQUENCE(SequenceChecker) {}
    
    template<typename T> struct Callback {
        void Run(T) {}
    };

    struct Vector {
        template <typename T>
        struct Type {
            struct vector_placeholder {
                T* begin() { return nullptr; }
                T* end() { return nullptr; }
                void clear() {}
            };
            vector_placeholder data;

            auto begin() { return data.begin(); }
            auto end() { return data.end(); }
            void clear() { data.clear(); }
        };
    };

    Vector::Type<Callback<LanguageDetectionModel>> model_loaded_callbacks_;
};

void LanguageDetectionModel::NotifyModelLoaded() {
    // Ensure that this method is called on the correct sequence
    DCHECK_CALLED_ON_VALID_SEQUENCE(sequence_checker_);

    // Iterate over each callback in the list of model loaded callbacks
    for (auto&& callback_ : model_loaded_callbacks_.data) {
        // Execute the callback, passing the current instance of the model
        callback_.Run(*this);
    }

    // Set the loaded flag to true, indicating the model is now loaded
    loaded_ = true;

    // Clear the list of model loaded callbacks as they have all been executed
    model_loaded_callbacks_.clear();
}

