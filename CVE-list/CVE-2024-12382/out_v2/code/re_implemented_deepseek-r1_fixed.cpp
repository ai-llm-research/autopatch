

class LanguageDetectionModel {
public:
    void NotifyModelLoaded();

private:
    bool loaded_ = false;
    struct Function {
        using callback_t = void(LanguageDetectionModel&);
        void operator()(LanguageDetectionModel& model) const {}
    };

    class vector {
    public:
        void clear() {}
        bool empty() const { return true; }
        void push_back(const Function&) {}
        Function& operator[](unsigned long) { static Function f; return f; }
        const Function& operator[](unsigned long) const { static Function f; return f; }
        unsigned long getSize() const { return 0; }
    };

    vector model_loadedcallbacks_;
    struct {
        void EnsureCalledOnValidSequence() const {}
    } sequence_checker_;

    static void DCHECK_CALLED_ON_VALID_SEQUENCE(const decltype(sequence_checker_)& sequence_checker) {
        sequence_checker.EnsureCalledOnValidSequence();
    }
};

void LanguageDetectionModel::NotifyModelLoaded() {
    DCHECK_CALLED_ON_VALID_SEQUENCE(sequence_checker_);

    for (unsigned long i = 0; i < model_loadedcallbacks_.getSize(); ++i) {
        model_loadedcallbacks_[i](*this);
    }

    loaded_ = true;
    model_loadedcallbacks_.clear();
}

